/*
	AudioSource.h
	20251001  hanaue sho
	音源を再生する機能
*/
#ifndef AUDIOSORCE_H_
#define AUDIOSORCE_H_
#include "Component.h"
#include "AudioSystem.h"
#include "AudioClip.h"
#include <memory>


class AudioSource : public Component
{
private:
	// ==================================================
	// 本体要素
	// ==================================================
	// --------------------------------------------------
	// 音源
	// --------------------------------------------------
	std::shared_ptr<AudioClip> m_Clip;
	// --------------------------------------------------
	// 音を鳴らすプレイヤー
	// --------------------------------------------------
	IXAudio2SourceVoice*	   m_Voice{};
	// --------------------------------------------------
	// 音量のキャッシュ
	// --------------------------------------------------
	float m_Volume = 1.0f;
	// --------------------------------------------------
	// フェード処理
	// --------------------------------------------------
	float m_FadeTime = 0.0f;
	float m_FadeTimer = 0.0f;
	float m_VolumeValue = 0.0f;
	bool m_IsFade = false;

public:
	using Component::Component;
	// ==================================================
	// 関数
	// ==================================================
	// --------------------------------------------------
	// 音源のセット
	// --------------------------------------------------
	void SetClip(const std::shared_ptr<AudioClip>& clip) { m_Clip = clip; }
	// --------------------------------------------------
	// 音源の再生
	// --------------------------------------------------
	void Play(bool loop = false);
	// --------------------------------------------------
	// 音源の停止
	// --------------------------------------------------
	void Stop();
	// --------------------------------------------------
	// 音源の音量設定
	// --------------------------------------------------
	void SetVolume(float v);
	// --------------------------------------------------
	// フェード処理
	// 指定した音量へ指定した時間をかけて処理する
	// targetVolume : 目的の音量
	// fadeTime		: フェードの時間
	// --------------------------------------------------
	void SetFade(float volume, float fadeTime);

	// ==================================================
	// ライフサイクル
	// ==================================================
	// --------------------------------------------------
	// 更新処理
	// --------------------------------------------------
	void Update(float dt) override;
	// --------------------------------------------------
	// 終了処理
	// --------------------------------------------------
	void Uninit() override;
};

#endif