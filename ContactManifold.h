/*
	ContactManifold.h
	20250901  hanaue sho
	接触点の情報の構造体
*/
#ifndef CONTACTMANIFOLD_H_
#define CONTACTMANIFOLD_H_
#include"Vector3.h"


// ==================================================
// ----- 接触点１つあたりの情報の構造体 -----
// ==================================================
struct ContactPoint
{
	// --------------------------------------------------
	// 接触点の位置
	// --------------------------------------------------
	Vector3 pointOnA{}; // Aのローカル接触点（Aの表面上）
	Vector3 pointOnB{}; // Bのローカル接触点（Bの表面上）
	// --------------------------------------------------
	// 貫入深度
	// --------------------------------------------------
	float penetration = 0.0f; 
	// --------------------------------------------------
	// 法線の累積正規インパルス（１軸ならスカラーで良い）
	// --------------------------------------------------
	float accumN = 0.0f; 
	// --------------------------------------------------
	// 接線の累積正規インパルス（１軸ならスカラーで良い）
	// --------------------------------------------------
	Vector3 accumImpulseT = Vector3();
	// --------------------------------------------------
	// 衝突点の反発バイアス
	// フレームの最初で計算したものを格納する
	// --------------------------------------------------
	float restitutionBias = 0.0f;
};

// ==================================================
// ----- 接触点の情報の構造体 -----
// ==================================================
struct ContactManifold
{
	// --------------------------------------------------
	// 接触点の最大個数
	// --------------------------------------------------
	static constexpr int MAX_POINTS = 4; // OBB*OBB なので４つに
	// --------------------------------------------------
	// 触れているか判定
	// --------------------------------------------------
	bool touching = false;
	// --------------------------------------------------
	// A → B への単位ベクトル
	// --------------------------------------------------
	Vector3 normal{};
	// --------------------------------------------------
	// 有効な接触点の数
	// --------------------------------------------------
	int count = 0;
	// --------------------------------------------------
	// 衝突点１つ当たりの情報
	// --------------------------------------------------
	ContactPoint points[4]; // 最大４点
};

#endif